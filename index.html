<!DOCTYPE html>
<html>
<head>
    <title>Field Stations Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDK8ugR-SpMP3PTvr0_XTPUI8yEd0Az1RU"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        .custom-map-control-button {
            background-color: #fff;
            border: 2px solid #fff;
            border-radius: 3px;
            box-shadow: 0 2px 6px rgba(0,0,0,.3);
            padding: 10px;
            cursor: pointer;
            text-align: center;
            font-size: 16px;
            color: black;
            font-family: Roboto, Arial, sans-serif;
            margin-right: 10px;
        }
        /* Container for buttons */
        .button-container {
            display: flex;
            justify-content: center; /* Align both buttons next to each other */
        }
        /* Watermark style */
        .watermark {
            position: absolute;
            bottom: 10px;
            left: 10px; /* Watermark now appears in the bottom left corner */
            font-size: 18px; /* Increased size */
            font-family: Arial, sans-serif;
            color: rgba(0, 0, 0, 0.6);
            font-weight: bold; /* Make watermark text slightly bolder */
            pointer-events: none;  /* Prevents the watermark from blocking map interactions */
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <!-- Watermark -->
    <div class="watermark">Â© 2024 by Vaibhav Kulkarni for Dr. Guillet</div>
    <script>
        let map;
        let userMarker;
        let followGPS = false; // Initially not following GPS

        function initMap() {
            // Initialize the map centered around the field stations area
            var mapCenter = { lat: 45.509827, lng: -75.823902 };
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 14,
                center: mapCenter,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                disableDefaultUI: true
            });

            // Add field station markers
            var stations = [
                { name: "Station 1: Parking lot", lat: 45.509827, lng: -75.823902 },
                { name: "Station 2: Bridge", lat: 45.509792, lng: -75.822759 },
                { name: "Station 3: Uphill after the bridge", lat: 45.509754, lng: -75.822207 },
                { name: "Station 4: Further uphill at left past the electric line", lat: 45.509527, lng: -75.821547 },
                { name: "Station 5: Damp zone at the right bottom hill", lat: 45.508137, lng: -75.818643 },
                { name: "Station 6: Clearing in a depression", lat: 45.508156, lng: -75.816337 },
                { name: "Station 7: Left about 25 m after the clearing", lat: 45.507761, lng: -75.816659 },
                { name: "Station 8: In front of the seating bench", lat: 45.507442, lng: -75.816597 },
                { name: "Station 9: Second clearing", lat: 45.506779, lng: -75.815827 },
                { name: "Station 10: Signpost in front of the access bridge", lat: 45.506395, lng: -75.814138 },
                { name: "Station 11: Twenty meters before the seating bench", lat: 45.506509, lng: -75.813854 },
                { name: "Station 12: Seating bench", lat: 45.506977, lng: -75.813716 },
                { name: "Station 13: Next seating bench", lat: 45.508289, lng: -75.813406 },
                { name: "Station 14: Lake on Gatineau Parkway", lat: 45.505971, lng: -75.822481 }
            ];

            stations.forEach(function(station, index) {
                var marker = new google.maps.Marker({
                    position: { lat: station.lat, lng: station.lng },
                    map: map,
                    title: station.name,
                    label: (index + 1).toString()  // Adding numbered labels to the markers
                });

                var infowindow = new google.maps.InfoWindow({
                    content: '<div><strong>' + station.name + '</strong></div>'
                });

                marker.addListener('click', function() {
                    infowindow.open(map, marker);
                });
            });

            // Create a button container to hold both buttons side by side
            var buttonContainer = document.createElement("div");
            buttonContainer.classList.add("button-container");

            // Add button to get user's current location
            var locationButton = document.createElement("button");
            locationButton.textContent = "Find My Location";
            locationButton.classList.add("custom-map-control-button");
            buttonContainer.appendChild(locationButton); // Add it to the button container

            // Add toggle button for enabling/disabling map center follow
            var followButton = document.createElement("button");
            followButton.textContent = "Enable Follow GPS";
            followButton.classList.add("custom-map-control-button");
            buttonContainer.appendChild(followButton); // Add it to the button container

            // Add the button container to the map
            map.controls[google.maps.ControlPosition.TOP_CENTER].push(buttonContainer);

            // Set up watchPosition for continuous GPS updates
            locationButton.addEventListener("click", function() {
                if (navigator.geolocation) {
                    navigator.geolocation.watchPosition(
                        function(position) {
                            var userPos = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };

                            // If a user marker exists, remove it before adding a new one
                            if (userMarker) {
                                userMarker.setMap(null);
                            }

                            // Add the new marker for the updated location
                            userMarker = new google.maps.Marker({
                                position: userPos,
                                map: map,
                                title: "You are here",
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 8,
                                    fillColor: "#00F",
                                    fillOpacity: 0.8,
                                    strokeWeight: 2,
                                    strokeColor: "#FFF"
                                }
                            });

                            // If followGPS is enabled, center the map
                            if (followGPS) {
                                map.setCenter(userPos);
                            }
                        },
                        function() {
                            alert("Geolocation failed or is not available.");
                        },
                        { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
                    );
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            });

            // Toggle button for enabling/disabling GPS follow
            followButton.addEventListener("click", function() {
                followGPS = !followGPS; // Toggle the followGPS state
                followButton.textContent = followGPS ? "Disable Follow GPS" : "Enable Follow GPS"; // Update button text
            });
        }

        // Load the map when the window loads
        window.onload = initMap;
    </script>
</body>
</html>
